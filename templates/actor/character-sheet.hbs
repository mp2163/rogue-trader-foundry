<form class="{{cssClass}} rogue-trader-sheet" autocomplete="off">
  {{!-- Sheet Header --}}
  <header class="sheet-header">
    <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" />
    <div class="header-fields">
      <h1 class="charname">
        <input name="name" type="text" value="{{actor.name}}" placeholder="Name" />
      </h1>
      <div class="header-details">
        <div class="field">
          <label>{{localize "ROGUE_TRADER.Origin"}}</label>
          <input type="text" name="system.details.origin" value="{{system.details.origin}}" />
        </div>
        <div class="field">
          <label>{{localize "ROGUE_TRADER.Career"}}</label>
          <input type="text" name="system.details.career" value="{{system.details.career}}" />
        </div>
        <div class="field">
          <label>{{localize "ROGUE_TRADER.Rank"}}</label>
          <input type="text" name="system.details.rank" value="{{system.details.rank}}" />
        </div>
      </div>
    </div>
    <div class="header-resources">
      <div class="resource wounds">
        <label>{{localize "ROGUE_TRADER.Wounds"}}</label>
        <div class="resource-inputs">
          <input type="number" name="system.wounds.value" value="{{system.wounds.value}}" data-dtype="Number" />
          <span class="separator">/</span>
          <input type="number" name="system.wounds.max" value="{{system.wounds.max}}" data-dtype="Number" />
          {{#if system.wounds.modifier}}
            <span class="modifier">(+{{system.wounds.modifier}})</span>
          {{/if}}
        </div>
      </div>
      <div class="resource fate">
        <label>{{localize "ROGUE_TRADER.FatePoints"}}</label>
        <div class="resource-inputs">
          <input type="number" name="system.fate.value" value="{{system.fate.value}}" data-dtype="Number" />
          <span class="separator">/</span>
          <input type="number" name="system.fate.max" value="{{system.fate.max}}" data-dtype="Number" />
        </div>
      </div>
      <div class="resource corruption">
        <label>{{localize "ROGUE_TRADER.Corruption"}}</label>
        <div class="resource-inputs">
          <input type="number" name="system.corruption.value" value="{{system.corruption.value}}" data-dtype="Number" min="0" />
        </div>
      </div>
      <div class="resource insanity">
        <label>{{localize "ROGUE_TRADER.Insanity"}}</label>
        <div class="resource-inputs">
          <input type="number" name="system.insanity.value" value="{{system.insanity.value}}" data-dtype="Number" min="0" />
        </div>
      </div>
      <div class="resource initiative">
        <button type="button" class="initiative-roll">
          <i class="fas fa-bolt"></i> {{localize "ROGUE_TRADER.RollInitiative"}}
        </button>
      </div>
    </div>
  </header>

  {{!-- Sheet Navigation --}}
  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item" data-tab="characteristics">{{localize "ROGUE_TRADER.Characteristics"}}</a>
    <a class="item" data-tab="skills">{{localize "ROGUE_TRADER.Skills"}}</a>
    <a class="item" data-tab="combat">{{localize "ROGUE_TRADER.Combat"}}</a>
    <a class="item" data-tab="inventory">{{localize "ROGUE_TRADER.Inventory"}}</a>
    <a class="item" data-tab="powers">{{localize "ROGUE_TRADER.Powers"}}</a>
    <a class="item" data-tab="traits">{{localize "ROGUE_TRADER.Traits"}}</a>
    <a class="item" data-tab="notes">{{localize "ROGUE_TRADER.Notes"}}</a>
  </nav>

  {{!-- Sheet Body --}}
  <section class="sheet-body">
    {{!-- Characteristics Tab --}}
    <div class="tab characteristics" data-group="primary" data-tab="characteristics">
      <div class="characteristics-grid">
        {{#each characteristics as |char key|}}
          <div class="characteristic">
            <label class="char-label">{{char.label}}</label>
            <div class="char-values">
              <input type="number" name="system.characteristics.{{key}}.value"
                     value="{{char.value}}" data-dtype="Number" class="char-base"
                     title="Base Value" />
              {{#if char.modifier}}
                <span class="char-modifier" title="Modifier from Traits">
                  {{#if (gt char.modifier 0)}}+{{/if}}{{char.modifier}}
                </span>
              {{/if}}
              <span class="char-total clickable characteristic-roll"
                    data-characteristic="{{key}}"
                    title="Click to roll, Shift+Click for quick roll">
                {{char.total}}
              </span>
              <span class="char-bonus" title="Bonus">{{char.bonus}}</span>
            </div>
          </div>
        {{/each}}
      </div>
    </div>

    {{!-- Skills Tab --}}
    <div class="tab skills" data-group="primary" data-tab="skills">
      <div class="skills-container">
        {{!-- Regular Skills --}}
        <div class="skills-list">
          {{#each skills as |skill key|}}
            <div class="skill-row" data-skill="{{key}}">
              <span class="skill-name clickable skill-roll" data-skill="{{key}}" title="Click to roll">
                {{skill.label}}
                <span class="skill-char">({{skill.charLabel}})</span>
                {{#if skill.isAdvanced}}{{#unless skill.isBasic}}<span class="skill-adv">Adv</span>{{/unless}}{{/if}}
              </span>
              <div class="skill-training">
                {{#if skill.isAdvanced}}
                <label class="checkbox-label" title="Make Basic (allows untrained use at half characteristic)">
                  <input type="checkbox" name="system.skills.{{key}}.isBasic" {{#if skill.isBasic}}checked{{/if}} />
                  B
                </label>
                {{/if}}
                <label class="checkbox-label" title="Trained">
                  <input type="checkbox" name="system.skills.{{key}}.trained" {{#if skill.trained}}checked{{/if}} />
                  T
                </label>
                <label class="checkbox-label" title="+10">
                  <input type="checkbox" name="system.skills.{{key}}.plus10" {{#if skill.plus10}}checked{{/if}} />
                  +10
                </label>
                <label class="checkbox-label" title="+20">
                  <input type="checkbox" name="system.skills.{{key}}.plus20" {{#if skill.plus20}}checked{{/if}} />
                  +20
                </label>
                <input type="number" name="system.skills.{{key}}.modifier" value="{{skill.modifier}}"
                       class="skill-mod" placeholder="±" title="Miscellaneous Modifier" data-dtype="Number" />
              </div>
              <span class="skill-total" title="Total target number">{{skill.total}}</span>
            </div>
          {{/each}}
        </div>

        {{!-- Specialization Skills --}}
        <div class="specializations-section">
          <h3>Specialization Skills</h3>
          {{#each specializations as |spec key|}}
            <div class="specialization-group" data-spec="{{key}}">
              <div class="spec-header">
                <span class="spec-name">{{spec.label}} <span class="skill-char">({{spec.charLabel}})</span></span>
                <a class="spec-add" data-spec="{{key}}" title="Add Specialization"><i class="fas fa-plus"></i></a>
              </div>
              <div class="spec-entries">
                {{#each spec.entries as |entry idx|}}
                  <div class="spec-entry" data-spec="{{../key}}" data-index="{{idx}}">
                    <input type="text" class="spec-entry-name" name="system.specializations.{{../key}}.{{idx}}.name"
                           value="{{entry.name}}" placeholder="Specialization..." />
                    <div class="skill-training">
                      <label class="checkbox-label" title="Make Basic (allows untrained use at half characteristic)">
                        <input type="checkbox" name="system.specializations.{{../key}}.{{idx}}.isBasic"
                               {{#if entry.isBasic}}checked{{/if}} />
                        B
                      </label>
                      <label class="checkbox-label" title="Trained">
                        <input type="checkbox" name="system.specializations.{{../key}}.{{idx}}.trained"
                               {{#if entry.trained}}checked{{/if}} />
                        T
                      </label>
                      <label class="checkbox-label" title="+10">
                        <input type="checkbox" name="system.specializations.{{../key}}.{{idx}}.plus10"
                               {{#if entry.plus10}}checked{{/if}} />
                        +10
                      </label>
                      <label class="checkbox-label" title="+20">
                        <input type="checkbox" name="system.specializations.{{../key}}.{{idx}}.plus20"
                               {{#if entry.plus20}}checked{{/if}} />
                        +20
                      </label>
                      <input type="number" name="system.specializations.{{../key}}.{{idx}}.modifier"
                             value="{{entry.modifier}}" class="skill-mod" placeholder="±"
                             title="Miscellaneous Modifier" data-dtype="Number" />
                    </div>
                    <span class="skill-total clickable spec-roll" data-spec="{{../key}}" data-index="{{idx}}"
                          title="Click to roll">{{entry.total}}</span>
                    <a class="spec-delete" data-spec="{{../key}}" data-index="{{idx}}" title="Delete">
                      <i class="fas fa-trash"></i>
                    </a>
                  </div>
                {{/each}}
              </div>
            </div>
          {{/each}}
        </div>
      </div>
    </div>

    {{!-- Combat Tab (Weapons & Armor) --}}
    <div class="tab combat" data-group="primary" data-tab="combat">
      {{!-- Armor Section --}}
      <div class="armor-section">
        <h3>{{localize "ROGUE_TRADER.Armor"}}</h3>
        <div class="armor-grid">
          <div class="armor-slot">
            <label>{{localize "ROGUE_TRADER.HitLocationHead"}}</label>
            <input type="number" name="system.armor.head" value="{{system.armor.head}}" data-dtype="Number" />
          </div>
          <div class="armor-slot">
            <label>{{localize "ROGUE_TRADER.HitLocationBody"}}</label>
            <input type="number" name="system.armor.body" value="{{system.armor.body}}" data-dtype="Number" />
          </div>
          <div class="armor-slot">
            <label>{{localize "ROGUE_TRADER.HitLocationRightArm"}}</label>
            <input type="number" name="system.armor.rightArm" value="{{system.armor.rightArm}}" data-dtype="Number" />
          </div>
          <div class="armor-slot">
            <label>{{localize "ROGUE_TRADER.HitLocationLeftArm"}}</label>
            <input type="number" name="system.armor.leftArm" value="{{system.armor.leftArm}}" data-dtype="Number" />
          </div>
          <div class="armor-slot">
            <label>{{localize "ROGUE_TRADER.HitLocationRightLeg"}}</label>
            <input type="number" name="system.armor.rightLeg" value="{{system.armor.rightLeg}}" data-dtype="Number" />
          </div>
          <div class="armor-slot">
            <label>{{localize "ROGUE_TRADER.HitLocationLeftLeg"}}</label>
            <input type="number" name="system.armor.leftLeg" value="{{system.armor.leftLeg}}" data-dtype="Number" />
          </div>
        </div>
      </div>

      {{!-- Weapons Section --}}
      <div class="items-section weapons">
        <div class="items-header">
          <h3>{{localize "ROGUE_TRADER.Weapons"}}</h3>
          <a class="item-create" data-type="weapon" title="Create Weapon">
            <i class="fas fa-plus"></i> {{localize "ROGUE_TRADER.AddWeapon"}}
          </a>
        </div>
        <ol class="item-list">
          {{#each weapons as |weapon|}}
            <li class="item weapon" data-item-id="{{weapon._id}}">
              <div class="item-image">
                <img src="{{weapon.img}}" title="{{weapon.name}}" />
              </div>
              <div class="item-name">
                <h4 class="item-edit">{{weapon.name}}</h4>
                <span class="weapon-type">{{weapon.system.attackType}}</span>
                <span class="weapon-damage">DMG: {{weapon.system.damage}}</span>
                <span class="weapon-pen">Pen: {{weapon.system.penetration}}</span>
              </div>
              <div class="item-controls">
                <button type="button" class="weapon-attack" title="Roll Attack">
                  <i class="fas fa-crosshairs"></i>
                </button>
                <button type="button" class="weapon-damage" title="Roll Damage">
                  <i class="fas fa-tint"></i>
                </button>
                <a class="item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                <a class="item-delete" title="Delete"><i class="fas fa-trash"></i></a>
              </div>
            </li>
          {{/each}}
        </ol>
      </div>
    </div>

    {{!-- Inventory Tab --}}
    <div class="tab inventory" data-group="primary" data-tab="inventory">
      <div class="inventory-summary">
        <span class="total-weight-label">{{localize "ROGUE_TRADER.TotalWeight"}}:</span>
        <span class="total-weight-value">{{totalCarriedWeight}} kg</span>
      </div>
      <div class="items-section gear">
        <div class="items-header">
          <h3>{{localize "ROGUE_TRADER.Gear"}}</h3>
          <a class="inventory-add" title="Add Item">
            <i class="fas fa-plus"></i> {{localize "ROGUE_TRADER.AddGear"}}
          </a>
        </div>
        <ol class="inventory-list">
          {{#each inventory as |item idx|}}
            <li class="inventory-item" data-index="{{idx}}">
              <input type="text" class="inv-name" data-field="name" value="{{item.name}}" placeholder="Item name..." />
              <input type="number" class="inv-qty" data-field="quantity" value="{{item.quantity}}" min="0" title="Quantity" />
              <input type="number" class="inv-weight" data-field="weight" value="{{item.weight}}" min="0" step="0.1" title="Weight (kg)" />
              <span class="inv-total-weight">({{item.totalWeight}} kg)</span>
              <a class="inventory-delete" data-index="{{idx}}" title="Delete"><i class="fas fa-trash"></i></a>
            </li>
          {{/each}}
        </ol>
      </div>
    </div>

    {{!-- Powers Tab --}}
    <div class="tab powers" data-group="primary" data-tab="powers">
      <div class="items-section powers">
        <div class="items-header">
          <h3>{{localize "ROGUE_TRADER.Powers"}}</h3>
          <a class="item-create" data-type="power" title="Create Power">
            <i class="fas fa-plus"></i> {{localize "ROGUE_TRADER.AddPower"}}
          </a>
        </div>
        <ol class="item-list">
          {{#each powers as |power|}}
            <li class="item power" data-item-id="{{power._id}}">
              <div class="item-image">
                <img src="{{power.img}}" title="{{power.name}}" />
              </div>
              <div class="item-name">
                <h4 class="item-edit">{{power.name}}</h4>
                <span class="power-info">
                  <span class="power-char">{{power.charLabel}}</span>
                  <span class="power-type">{{power.rollTypeLabel}}</span>
                  {{#if power.system.modifier}}
                    <span class="power-mod">
                      {{#if (gt power.system.modifier 0)}}+{{/if}}{{power.system.modifier}}
                    </span>
                  {{/if}}
                  {{#if power.system.damage}}
                    <span class="power-damage">DMG: {{power.system.damage}}</span>
                  {{/if}}
                </span>
              </div>
              <div class="item-controls">
                <button type="button" class="power-roll" title="Roll Power">
                  <i class="fas fa-dice-d20"></i>
                </button>
                {{#if power.system.damage}}
                  <button type="button" class="power-damage" title="Roll Damage">
                    <i class="fas fa-tint"></i>
                  </button>
                {{/if}}
                <a class="item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                <a class="item-delete" title="Delete"><i class="fas fa-trash"></i></a>
              </div>
            </li>
          {{/each}}
        </ol>
      </div>
    </div>

    {{!-- Traits Tab --}}
    <div class="tab traits" data-group="primary" data-tab="traits">
      <div class="items-section traits">
        <div class="items-header">
          <h3>{{localize "ROGUE_TRADER.Traits"}}</h3>
          <a class="item-create" data-type="trait" title="Create Trait">
            <i class="fas fa-plus"></i> {{localize "ROGUE_TRADER.AddTrait"}}
          </a>
        </div>
        <ol class="item-list">
          {{#each traits as |trait|}}
            <li class="item trait" data-item-id="{{trait._id}}">
              <div class="item-image">
                <img src="{{trait.img}}" title="{{trait.name}}" />
              </div>
              <div class="item-name">
                <h4 class="item-edit">{{trait.name}}</h4>
                {{#if trait.modifierSummary}}
                  <span class="trait-modifiers">{{trait.modifierSummary}}</span>
                {{/if}}
              </div>
              <div class="item-controls">
                <a class="item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                <a class="item-delete" title="Delete"><i class="fas fa-trash"></i></a>
              </div>
            </li>
          {{/each}}
        </ol>
      </div>
    </div>

    {{!-- Notes Tab --}}
    <div class="tab notes" data-group="primary" data-tab="notes">
      <div class="editor-container">
        {{editor system.details.notes target="system.details.notes" button=true owner=owner editable=editable}}
      </div>
    </div>
  </section>
</form>
